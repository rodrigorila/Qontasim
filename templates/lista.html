{% extends "bootstrap/base.html" %}
{% block title %}Lista de reservas{% endblock %}

{% block navbar %}
{% endblock %}

{% block styles %}
    {{super()}}
    <link rel="stylesheet" href="{{url_for('static', filename='stylesheets/lista.css')}}">
    <!--<link href="{{bootstrap_find_resource('css/bootstrap.css', cdn='bootstrap')}}" rel="stylesheet">-->

{% endblock %}

{% block content %}
    <div class="container">
        <table class="table table-responsive table-condensed" id="table_reservas">
            <thead>
                <tr>
                    <th colspan="5" class="text-left">Reservas</th>
                </tr>
            </thead>
            <tbody>
            {% for reserva in Reservas %}
                <tr>
                    <td class="text-left" colspan="2"><h1>{{ reserva.Nombre }}</h1></td>
                    <td class="text-center" style="vertical-align: middle;" rowspan="2" id = "DueTime{{loop.index}}"></td>
                    <td class="text-center" style="vertical-align: middle;" rowspan="2">
                        <!--<button class="btn btn-primary btn-lg" tag="enter" reservation_id="{{ reserva.ID }}">-->
                            <!--<span class="glyphicon glyphicon-ok-circle" />-->
                        <!--</button>-->
                        <a style="cursor:pointer" tag="enter" reservation_id="{{ reserva.ID }}">
                            <h1><span class="glyphicon glyphicon-ok-circle"></span></h1>
                        </a>
                    </td>
                    <td class="text-center" style="vertical-align: middle;" rowspan="2">
                        <a style="cursor:pointer" tag="cancel" reservation_id="{{ reserva.ID }}">
                            <h1><span class="glyphicon glyphicon-remove-circle"></span></h1>
                        </a>
                    </td>
                </tr>
                <tr>
                    <td class="text-right small">{{ reserva.Telefono }}</td>
                    <td class="text-center small" id = "Date{{loop.index}}">{{ reserva.Reserva }}</td>
                </tr>
            {% endfor %}

            </tbody>
        </table>
    </div>
    <div class="container">
        <a href="/nueva" class="btn btn-primary btn-lg">Nueva</a>
    </div>
{% endblock %}

{% block scripts %}
    {{super()}}

    <script src="{{ url_for('static', filename='base.js') }}"></script>
    <script src="{{ url_for('static', filename='reservation.js') }}"></script>
    <script src="{{ url_for('static', filename='reservations_table.js') }}"></script>
    <script>
        $(document).ready(function(){
            var table_reservas = document.getElementById("table_reservas");

            var data = new ReservationsTable(table_reservas, "Date", "DueTime");

            console.log("data.count = " + data.count);

            var reservation_status_timer = setInterval(function() {

                for (var i=0; i<data.count; i++) {

                    var r = new Reservation(new Date(data.date(i).innerHTML));

                    var lapse = r.get_lapse();

                    data.dueTime(i).innerHTML = r.get_status(lapse);
                }
            }, 1000);

            $("a[tag='enter']").click(function(){
                console.log("Enter: " + $(this).attr("reservation_id"));
            });

            $("a[tag='cancel']").click(function(){
                console.log("Cancel: " + $(this).attr("reservation_id"));
            });
        });
    </script>
{% endblock %}