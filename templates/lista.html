{% extends "bootstrap/base.html" %}
{% block title %}This is an example page{% endblock %}

{% block navbar %}
{% endblock %}

{% block content %}
    <div class="container">
        <table class="table table-hover" id="table_reservas">
            <thead>
            <tr>
                <th class="text-left">Nombre</th>
                <th class="text-right">Telefono</th>
                <th style="display: none;">Reserva</th>
                <th class="text-center">Estado</th>
                <th></th>
                <th></th>
            </tr>
            </thead>
            <tbody>
            {% for reserva in Reservas %}
            <tr>
                <td class="text-left">{{ reserva.Nombre }}</td>
                <td class="text-right">{{ reserva.Telefono }}</td>
                <td id = "Date" style="display: none;">{{ reserva.Reserva }}</td>
                <td id = "DueTime" class="text-center"></td>
                <td><button class="btn btn-primary btn-lg">Ingresar</button></td>
                <td><button class="btn btn-primary btn-lg">Cancelar</button></td>
            </tr>
            {% endfor %}

            </tbody>
        </table>
    </div>
    <div class="container">
        <a href="/nueva" class="btn btn-primary btn-lg">Nueva</a>
    </div>
{% endblock %}

{% block scripts %}
    {{super()}}

    <script src="{{ url_for('static', filename='base.js') }}"></script>
    <script src="{{ url_for('static', filename='reservation.js') }}"></script>
    <script>
        var table_reservas_rows = document.getElementById("table_reservas").rows;

        if (table_reservas_rows == null)
            exit;

        console.log("AQU√ç UNA SOLA VEZ");

        var reservation_status_timer = setInterval(function() {

            console.log(table_reservas_rows.length);

            for (var i=0, len=table_reservas_rows.length; i<len; i++) {
                var row = table_reservas_rows[i];

                var date = row.cells.namedItem("Date");
                var dueTime = row.cells.namedItem("DueTime");

                if (date == null || dueTime == null)
                    continue;

                console.log(date.innerHTML);

                var r = new Reservation(date.innerHtml);

                var lapse = r.get_lapse();

                dueTime.innerHTML = r.get_status(lapse);

                console.log(dueTime.innerHTML);
            }
        },
        1000);
    </script>
{% endblock %}